---
layout: post
title: 'Resolved: 如何更新 git 补丁'
categories:
- Z-Turn
tags: []
published: true
comments: true
---
<p>使用git制作补丁时，经常发现补丁需要修改。如果只是最后一次commit需要修改，那就好办，用下面的方法就可以搞定：
<pre lang="bash">
$ git reset HEAD^
# edit edit edit
$ git commit -a -s -c ORIG_HEAD
$ git format-patch --subject-prefix="PATCH v2"
</pre></p>

<p>但是如果是一系列补丁中的中间几个补丁需要修改，该怎么办呢？</p>

<p><del datetime="2012-01-03T16:12:57+00:00">笨办法已经被删掉>.<</del></p>

<p><!--more--><strong>Update 1:</strong> 非常感谢wangcong的指点！"<code>git rebase -i</code>"可以出色地完成这个任务，方法在man-page里面有详述，见"INTERACTIVE MODE"和"SPLITTING COMMITS"部分。</p>

<p>假设当前所在分支名为"topic"，做了3个补丁，打算提交给邮件列表的时候发现中间一个补丁需要更新，此时使用下列命令：</p>

<p><pre lang="bash">
git rebase -i master
</pre></p>

<p>出现编辑窗口如下：
<blockquote>
pick 21732a8 mm/swapping01: new testcase<br />
pick c3751d1 hugemmap01: clean-up format<br />
pick d75449c mm/swapping01: change sleep time to 5 sec
</blockquote></p>

<p>此时需要修改commit c3751d1，则把<code>pick</code>改为<code>edit</code>即可。保存退出后git会rebase到需要修改的commit处停止，此时可以直接修改内容，然后执行：
<pre lang="bash">
git add xxx # mark as resolved
git commit --amend
</pre></p>

<p>或者
<pre lang="bash">
git reset --soft HEAD^
#edit edit edit
git commit -a -s -c ORIG_HEAD
</pre></p>

<p>之后执行"<code>git rebase --continue</code>"即可。</p>

<p>突然想起来一年前就请教过wangcong这个问题，只不过当时对<code>git rebase</code>完全不了解，后来就忘了，惭愧-_-|||。</p>

<p><strong>Update 2</strong>: 同样感谢Iven的指点，可以去看看他的文章：<a href="http://www.kissuki.com/?p=135" target="_blank">http://www.kissuki.com/?p=135</a></p>
