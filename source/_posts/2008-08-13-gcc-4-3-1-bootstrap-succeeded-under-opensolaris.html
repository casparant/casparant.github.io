---
layout: post
title: OpenSolaris编译安装gcc4.3.1成功
categories:
- Z-Turn
tags:
- bootstrap
- config
- gcc
- Opensolaris
published: true
comments: true
---
<p>编译时间为1小时零12分钟，调试错误的时间累计就不知道多少了。要编译的语言为c,c++,f95。之前出过N多的错误，因为时间过去太久了，有些错误的名字记不太清楚了，只大概地写一下：</p>

<p><blockquote>Fatal error in reader: makefile, line XXX: Unexpected end of line seen</blockquote></p>

<p>解决这个问题，需要安装gmake，因为OpenSolaris中自带的语法和gnu make的语法可能不一样。</p>

<p>接下去碰到的问题，是采用以下编译选项的：</p>

<p><pre lang="bash" line="1">./configure --prefix=/usr/local \
--with-gnu-ld=/usr/gnu/bin/ld; \
gmake all</pre></p>

<p>出错提示有很多，都记不太清了，比如：</p>

<p><blockquote>configure: error: cannot compute suffix of object files: cannot compile</blockquote></p>

<p><blockquote>[gmake] *** cannot create rule to make target `all' ***</blockquote></p>

<p><blockquote>ld errors: no .eh_frame_hdr table will be created.</blockquote></p>

<p>在网上找到这个网页：<a href="http://www.linuxidc.com/Linux/2008-07/14125p2.htm">http://www.linuxidc.com/Linux/2008-07/14125p2.htm</a></p>

<p>看到如下的configure选项：</p>

<p><!--more--><pre lang="bash" line="1">
./configure --prefix=/usr 
--libdir=/usr/lib 
--libexecdir=/usr/lib 
--enable-shared 
--enable-threads=posix 
--enable-__cxa_atexit 
--enable-c99 
--enable-long-long 
--enable-clocale=gnu 
--disable-libstdcxx-pch 
--disable-multilib 
--enable-languages=c,c++,f95</pre></p>

<p>第1,2,3不是关键选项。继续查找资料，第4项在gcc的README里面说明了是默认打开的。第5项我把posix改成了solaris，第6项在有glibc的情况下下才有用，第7,8,9,10没找到相关说明，第11项是禁止多个平台的库都编译(我觉得我过去几天没编译成功的原因很可能就是这样的，因为总是在AMD64相关的目录下编译，我的机子可是i386啊…)，最后一项指定要安装的语言，我下的是core包和自己要装的语言包，就用不着这个命令了。</p>

<p>所以最后选定编译选项为：
<pre lang="bash" line="1">./configure --prefix=/usr/local \
--enable-threads=posix \
--disable-multilib \
--with-gnu-ld=/usr/gnu/bin/ld</pre></p>

<p>make的时候命令是</p>

<p><pre lang="bash" line="1">make bootstrap</pre></p>

<p>它显式指定了bootstrap，但是我看到帮助文档上说默认是开启了3-stage的bootstrap模式的，所以我觉得这也不是关键。</p>

<p>中途只报了一个错，错误的内容大致是</p>

<p><blockquote>libgcc.map has not a good format and tries without success to use it as ld script</blockquote></p>

<p>查到解决方案是，把/gcc-4.3.1/gcc/config/t-slibgcc-sld文件第13行修改一下，把-M参数改为-Map参数，修改后的那一行如下：<br />
    <pre lang="bash" line="1">-Wl,-Map,$(SHLIB_MAP) -o $(SHLIB_DIR)/$(SHLIB_SONAME).tmp \</pre></p>

<p>然后重新configure XXX, gmake bootstrap, gmake install</p>

<p>整个过程真是艰辛阿，而且gcc编译出来之后发现，原来不是gcc的问题，还得想办法找glibc在OpenSolaris上的porting。</p>
