
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Linux启动时的一些闲言碎语 - Ant-Veil</title>
  <meta name="author" content="Caspar">

  
  <meta name="description" content="这两天被启动的东西给弄晕了，现在回过神来写一段备用。 一、启动冲突 造成启动冲突的原因往往只有一个，MBR覆盖。比如先装的XP再装的Linux，Linux就会把XP安装时写入MBR的数据给覆盖掉，如果先装Ubuntu再装Fedora， &hellip;">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  
  <link rel="canonical" href="http://casparant.github.io/blog/2008/01/21/linux-about-boot">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ant-Veil" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <div id="sidebar_control"></div>
  <div id="sidebar">
    <div class="logo">
      Ant
    </div>
    <div class="content hide">
      <section role="navigation">
        <header role="banner"><hgroup>
  <h1><a href="/">Ant-Veil</a></h1>
  
    <h2>Caspar Blog</h2>
  
</hgroup>

</header>
        
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:casparant.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
  <li><a href="/">home</a></li>
  <li><a href="//wg.dotkrnl.com/p/public">public</a></li>
</ul>


      </section>
      
        <section>
  <h2>recent</h2>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/10/fix-razer-orochi-re-connect-issue/">Fix Razer Orochi Re-connect Issue</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/21/configure-openconnect-in-gentoo-kde/">Gentoo KDE 下折腾 OpenConnect</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/11/an-introduction-of-wiz-note/">WizNote: 终于找到比较干净的QT的笔记软件</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/06/some-misc-items-of-mce/">Mce的一些零散记录</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/03/how-to-update-your-git-patches/">Resolved: 如何更新git补丁</a>
      </li>
    
  </ul>
</section>





      
    </div>
  </div>
  <div id="main">
    <div class="content">
      <article class="hentry" role="article">
  
  
    <header>
      <div class="back"><a href="/" onclick="history.go(-1);return false;">← Back</a></div>
      <h1 class="entry-title">Linux启动时的一些闲言碎语</h1>
    </header>
  
  <div class="entry-content"><p>这两天被启动的东西给弄晕了，现在回过神来写一段备用。</p>

<p><h3>一、启动冲突</h3></p>

<p>造成启动冲突的原因往往只有一个，MBR覆盖。比如先装的XP再装的Linux，Linux就会把XP安装时写入MBR的数据给覆盖掉，如果先装Ubuntu再装Fedora，Fedora的GRUB会安装到MBR上覆盖了Ubuntu的GRUB。这些情况都可能会造成某些操作系统不能启动。</p>

<p>幸好Linux在这方面还算人性化，它在覆盖XP在MBR中的数据之后，会自动搜索可启动的Windows分区，并且把XP的启动信息写到自己GRUB的menu.lst中，这样在装完Linux后能在启动菜单上看见原先的 Windows启动项（通常在最后一项）。</p>

<p>而有时候不小心会把Windows弄坏，需要重装Windows，等你Windows重新装好了，Linux也就启动不了了，因为Windows把MBR又给更新了。Windows和Linux抢MBR的矛盾一直如此激化……</p>

<p>那么如何防止两个系统吵架呢？两种方法。</p>

<p><!--more-->第一种就是事后修复。用任何一张可以引导到grub的启动盘（比如，可以是你的LiveCD），进入grub。如果先进入的是终端，那么以超级用户模式在终端中输入<code>grub</code>即可进入终端，然后进行grub修复安装过程，如果你知道你的磁盘序号X（一般为0）和Linux分区序号(Partition Number)Y（从0开始数），那么可以运行：</p>

<p><pre lang="cpp">root (hdX,Y)
setup (hd0)</pre></p>

<p>后面一句的hd0表示把grub写到MBR上。</p>

<p>也可以简单地一句话：</p>

<p><pre lang="cpp">setup (hd0) (hdX,Y)</pre></p>

<p>成功了的话会返回successful.</p>

<p>如果不知道或者忘记了Linux的分区序号（磁盘序号你应该知道吧，要是不确定就填0），先键入</p>

<p><pre lang="cpp">root (hdX,</pre></p>

<p>然后按TAB键两次，将会出现自动补全信息，此时你应该就知道Linux分区所在的序号了吧。</p>

<p>输入完毕后仍旧再进行setup操作。这样重启后GRUB就修复了。</p>

<p>第二种方法就是在重装XP前，先把Linux写在MBR里的信息给保存出来，保存成一个文件，通常这个文件的大小必须是512字节。运行这个命令：</p>

<p><pre lang="bash">sudo dd if=/dev/sda of=~/linux bs=512 count=1</pre></p>

<p>（如果是SCSI硬盘则为sda，IDE硬盘为hda。of=后面的路径为输出路径，路径和文件名可以任意。）</p>

<p>就可以把MBR中的前512字节的信息保存到用户文件夹下名为linux的文件中。</p>

<p>然后重装XP，把这个linux文件放到Winodws分区中，为了便于管理，我们习惯上将其放入C盘根目录下。</p>

<p>接着修改XP的boot.ini，在最后一行添加如下语句：</p>

<p><code>c:\linux="Ubuntu Linux Operation System"</code></p>

<p>并修改启动菜单读秒的长度。</p>

<p>重启之后想办法进入DOS重写分区表：</p>

<p><pre lang="bash">fdisk /mbr</pre></p>

<p>再次重启就可以看到，XP的启动管理器中出现了双启动菜单，而选择"Ubuntu Linux Operation System"就和以前进入MBR的时候一样了。这种方法的原理也很清晰，将MBR头512字节（包含启动信息的头512字节啊～～）保存成文件，让Windows系统来调用这个文件并且处理启动。</p>

<p>以后重装Windows，只要实现把那个长度为512字节的“linux”文件转移到别处，装完后移回来，修改boot.ini就可以了。<br />
Linux不同发行版之间也需要协调才能和平共处，装了Ubuntu，还想装个Fedora，于是在硬盘上独立分区安装。结果装好后Ubuntu进不去了。想到肯定是Fedora也霸道地把自己的启动信息写到MBR中去而覆盖了Ubuntu的信息了。</p>

<p>于是想到修改menu.lst，因为menu.lst可以显示处理启动菜单。把Ubuntu分区挂载之后，找到Ubuntu下的menu.lst，把和它有关的启动语句给复制到Fedora的menu.lst中，重启电脑，可以了。</p>

<p><h3>二、关于menu.lst</h3></p>

<p>menu.lst用于管理启动菜单项。包括是否隐藏启动菜单、启动菜单倒计时、启动项显示等选项。一般的操作顾名思义就可以看懂是什么意思。</p>

<p>值得一提的是Linux的启动都是通过这两个文件的引导：kernel的vmlinuz-XXXXX和initrd的initrd.img。也就是说需要引导一个操作系统的话，在grub的menu中告知这两个文件所在的分区，加入这两个文件的路径就可以启动了。</p>

<p>比如：</p>

<p><blockquote>title Ubuntu<br />
root root(hd0,0)<br />
kernerl /boor/vmlinuz-2.6.22-14-generic root=UUID=XXXXXX ro quiet splash locale=zh_CN<br />
initrd /boot/initrd.img-2.6.22-14-generic
</blockquote></p>

<p><h3>三、启动时候的挂载</h3></p>

<p>老是手动挂一个分区太麻烦了，于是想到用fstab来自动挂载</p>

<p>fstab的每一个非注释行都挂了一个分区到对应路径下，其参数分别为：挂载的设备 挂载点 文件格式 挂载模式（此后的一大段我不甚了解）</p>

<p>“挂载的设备”中，我试过/dev/sda1这种的格式，发现不好使；再看看用UUID，先手动挂载需要的盘，在终端键入</p>

<p><pre lang="bash">ls -l /dev/disks/by-uuid</pre></p>

<p>显示每个分区的uuid，一串乱七八糟的数字，在fstab中写下：</p>

<p><pre lang="bash">UUID=xxxxxxxxxxxxxx /media/sda8 vfat user,noauto,utf8,umask=000,gid=46 0 0</pre></p>

<p>搞定。</p>
</div>
  <footer>
    <div class="articlemeta">
      <span class="hide">
        

<span class="categories">
  
    <a class='category' href='/blog/categories/deprecated/'>deprecated</a>
  
</span>

 @
        








  


<time datetime="2008-01-21T00:00:00+08:00" pubdate data-updated="true"></time>
      </span>
      <span class="plus">
        
          <a href="#disqus_thread" onclick="return false;" data-disqus-identifier="http://casparant.github.io/blog/2008/01/21/linux-about-boot/">+</a>
        
      </span>
    </div>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://casparant.github.io/blog/2008/01/21/linux-about-boot/" data-via="" data-counturl="http://casparant.github.io/blog/2008/01/21/linux-about-boot/" >Tweet</a>
  
  
  
</div>

    
    <div class="meta">
      
        <a class="basic-alignment left" href="/blog/2008/01/20/ubuntu-gutsy-config/" title="Previous Post: Ubuntu 7.10 Configuration">&laquo; Ubuntu 7.10 Configuration</a>
      
    </div>
  </footer>


</article>

  <section>
    <div class="hide" id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>


    </div>
    <footer role="contentinfo"><div class="content">
  <p>
    Copyright &copy; 2015 Caspar
  </p>
</div>

</footer>
    

<script type="text/javascript">
  disqus_shortname = 'casparant';
  
    disqus_identifier = 'http://casparant.github.io/blog/2008/01/21/linux-about-boot/';
    disqus_url = 'http://casparant.github.io/blog/2008/01/21/linux-about-boot/';
    function loadDisqus() {
      
      // var disqus_developer = 1;
      var disqus_script = 'embed.js';
      (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    }
  
  (function () {
    var disqus_script = 'count.js';
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
  <script src="/javascripts/modernizr-2.0.js"></script>
<script src="//ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
<script src="/javascripts/libs/respond.js" type="text/javascript"></script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>


<script type="text/javascript">
$(document).ready(function(){
  var userAgent = navigator.userAgent.toLowerCase();
  var isiPhone = (userAgent.indexOf('iphone') != -1 || userAgent.indexOf('ipod') != -1) ? true : false;
  var isAndroid = (userAgent.indexOf('android') != -1) ? true : false;
  clickEvent = (isiPhone || isAndroid) ? 'touchstart' : 'click';
  $('#sidebar').on(clickEvent, function() {
    $(this).toggleClass('open');
  });
  $('.articlemeta').on(clickEvent, function() {
    toggleDisqus();
    $(this).toggleClass('open');
  });
});
</script>

</body>
</html>
