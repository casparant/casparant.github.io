
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Fix Razer Orochi re-connect issue  | Ant-Veil</title>

	<meta name="author" content="Caspar"> 
	
	<meta name="description" content="Issue: 雷蛇八歧大蛇2013版鼠标，短时间内不用自动休眠，系统中蓝牙连接断(expected)，鼠标从休眠恢复后系统中的蓝牙连接却无法自动重连，只能将鼠标置为配对模式，通过系统中的蓝牙工具手工连接。 Environment: Razer Orochi 蓝牙鼠标
Gentoo + KDE &hellip;"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Ant-Veil" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	
</head>



<body>
	<header id="header" class="inner"><h1>Ant-Veil</h1>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archive</a></li>
	<li><a href="/blog/about">About</a></li>
    <li><a href="/blog/categories/kernel">Kernel</a></li>
    <li><a href="/blog/categories/z-turn">Z-Turn</a></li>
</ul>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">Fix Razer Orochi Re-connect Issue</h2>
	<div class="entry-content"><p>Issue:</p>

<p>雷蛇八歧大蛇2013版鼠标，短时间内不用自动休眠，系统中蓝牙连接断(expected)，鼠标从休眠恢复后系统中的蓝牙连接却无法自动重连，只能将鼠标置为配对模式，通过系统中的蓝牙工具手工连接。</p>

<p>Environment: </p>

<p><blockquote>Razer Orochi 蓝牙鼠标<br />
Gentoo + KDE<br />
kernel 3.10 ~ 3.16<br />
bluez 4.101 ~ 5.23<br />
bluedevil 1.3.2 ~ 2.0_rc1</blockquote></p>

<p>Solution:</p>

<p><!--more--></p>

<p>通过 hcidump 工具发现：</p>

<p><blockquote>
> HCI Event: Connect Request (0x04) plen 10<br />
    bdaddr F0:65:DD:94:9F:BB class 0x002580 type ACL<br />
> HCI Event: Command Status (0x0f) plen 4<br />
    Accept Connection Request (0x01|0x0009) status 0x00 ncmd 1<br />
> HCI Event: Connect Complete (0x03) plen 11<br />
    status 0x00 handle 13 bdaddr F0:65:DD:94:9F:BB type ACL encrypt 0x00<br />
> HCI Event: Command Status (0x0f) plen 4<br />
    Read Remote Supported Features (0x01|0x001b) status 0x00 ncmd 1<br />
> HCI Event: Read Remote Supported Features (0x0b) plen 11<br />
    status 0x00 handle 13<br />
    Features: 0xbf 0x00 0xa0 0x78 0x18 0x1e 0x59 0x83<br />
> HCI Event: Command Status (0x0f) plen 4<br />
    Read Remote Extended Features (0x01|0x001c) status 0x00 ncmd 1<br />
> HCI Event: Read Remote Extended Features (0x23) plen 13<br />
    status 0x00 handle 13 page 1 max 1<br />
    Features: 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00<br />
> HCI Event: Command Status (0x0f) plen 4<br />
    Remote Name Request (0x01|0x0019) status 0x00 ncmd 1<br />
> HCI Event: Remote Name Req Complete (0x07) plen 255<br />
    status 0x00 bdaddr F0:65:DD:94:9F:BB name 'Razer Orochi 2013'<br />
> HCI Event: Command Complete (0x0e) plen 10<br />
    Link Key Request Negative Reply (0x01|0x000c) ncmd 1<br />
    status 0x00 bdaddr F0:65:DD:94:9F:BB<br />
> HCI Event: Disconn Complete (0x05) plen 4<br />
    status 0x00 handle 13 reason 0x13<br />
    Reason: Remote User Terminated Connection</blockquote></p>

<p>出现 Link Key Request Negative Reply 的字样，怀疑是配对的时候使用自动 key，而蓝牙工具没有保存这个自动 key，导致鼠标从休眠恢复时试图以空 key 连接，从而失败。</p>

<p>知道了问题，解决方法就简单了，配对的时候手工输入 key/PIN 为 1234，连接即可。</p>

<p>就这么一个破问题，折腾了我半天时间，内核、bluez、bluedevil 都尝试了一遍，还在人家的 Macbook 上测试了一番。差点就冲动下单换 Mac 了。 #我不是土豪#
</p>
</div>


<div class="meta">
	<div class="date">








  



<time datetime="2014-10-10T00:00:00+08:00" pubdate data-updated="true">Oct 10th, 2014</time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/deprecated/'>deprecated</a>

</div>


</div>
</article>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015
 Caspar 
<br>
Powered by Octopress.
</footer>
	

</body>
</html>
